import{Aa as o,Ab as oe,Ba as c,Bb as ae,Ca as w,Cb as re,Da as g,Db as le,Ea as v,Eb as ne,Fa as T,Fb as de,Ga as I,Gb as se,Ha as B,Hb as ce,Ia as d,Ib as me,Jb as ue,Ka as _,Kb as pe,La as G,Lb as fe,M as F,Ma as M,Mb as y,Na as O,Nb as ge,Oa as A,Ob as ve,P as N,Pa as z,U as p,V as f,Ya as R,Za as L,_a as j,a as m,b as P,bb as K,cb as q,fb as Q,ga as r,gb as U,hb as W,ib as H,ja as S,kb as J,lb as X,mb as Y,nb as Z,oa as V,pb as $,q as E,qa as b,xb as ee,ya as n,yb as te,za as l,zb as ie}from"./chunk-ZOJ6HQZC.js";var ye="https://api-sica-prolog-fmepggdmdnaxb5ac.mexicocentral-01.azurewebsites.net/api/Products/from-wsdl",x=class s{constructor(t){this.http=t}getProducts(t,e,i,a){let{claveBodega:h=1,claveCompania:u=1,idioma:Ce=2058,forceRefresh:be=!1}=a??{},k=new K().set("claveBodega",String(h)).set("claveCompania",String(u)).set("idioma",String(Ce)).set("page",String(t)).set("pageSize",String(e)).set("forceRefresh",String(be));return i&&i.trim()&&(k=k.set("search",i.trim())),this.http.get(ye,{params:k}).pipe(E(C=>{let D=Array.isArray(C?.items)?C.items:[],we=typeof C?.total=="number"?C.total:D.length;return{data:D,total:we}}))}static \u0275fac=function(e){return new(e||s)(N(q))};static \u0275prov=F({token:s,factory:s.\u0275fac,providedIn:"root"})};var ke=()=>({enabled:!0,mode:"multiple",checkboxOnly:!0});function Pe(s,t){if(s&1){let e=w();l(0,"button",9),g("click",function(a){let h=p(e).$implicit,u=v();return f(u.onEditClick(a,h))}),d(1," Editar "),o()}}function Se(s,t){if(s&1&&c(0,"kendo-grid-column",10),s&2){let e=t.$implicit;n("field",e.field)("title",e.title)("width",e.width??150)("filter",e.filter||"text")("headerClass",e.headerClass||"")}}function De(s,t){if(s&1&&d(0),s&2){let e=t.total,i=t.skip,a=t.pageSize;G(" Mostrando ",i+1," - ",i+a>e?e:i+a," de ",e," productos ")}}function Ee(s,t){if(s&1){let e=w();l(0,"kendo-dialog",11),g("close",function(){p(e);let a=v();return f(a.closeDialog())}),l(1,"kendo-dialog-titlebar"),d(2),o(),l(3,"form",12)(4,"div",13)(5,"label"),d(6,"Clave Producto"),o(),c(7,"input",14),o(),l(8,"div",13)(9,"label"),d(10,"Nombre"),o(),c(11,"input",15),o(),l(12,"div",13)(13,"label"),d(14,"Peso"),o(),c(15,"kendo-numerictextbox",16),o(),l(16,"div",13)(17,"label"),d(18,"Volumen"),o(),c(19,"kendo-numerictextbox",17),o(),l(20,"div",13)(21,"label"),d(22,"Largo"),o(),c(23,"kendo-numerictextbox",18),o(),l(24,"div",13)(25,"label"),d(26,"Ancho"),o(),c(27,"kendo-numerictextbox",19),o(),l(28,"div",13)(29,"label"),d(30,"Alto"),o(),c(31,"kendo-numerictextbox",20),o(),l(32,"div",13)(33,"label"),d(34,"Etiqueta"),o(),c(35,"input",21),o(),l(36,"div",13)(37,"label"),d(38,"Control Caja"),o(),c(39,"kendo-dropdownlist",22),o(),l(40,"div",13)(41,"label"),d(42,"Certificado"),o(),c(43,"kendo-dropdownlist",23),o(),l(44,"div",13)(45,"label"),d(46,"Asignar Lote"),o(),c(47,"kendo-dropdownlist",24),o(),l(48,"div",13)(49,"label"),d(50,"Localizaci\xF3n"),o(),c(51,"input",25),o()(),l(52,"kendo-dialog-actions")(53,"button",26),g("click",function(){p(e);let a=v();return f(a.closeDialog())}),d(54,"Cancelar"),o(),l(55,"button",27),g("click",function(){p(e);let a=v();return f(a.saveChanges())}),d(56),o()()()}if(s&2){let e=v();r(2),_(" Producto: ",e.current==null?null:e.current.claveProducto," "),r(),n("formGroup",e.editForm),r(12),n("format","n2"),r(4),n("format","n4"),r(4),n("format","n2"),r(4),n("format","n2"),r(4),n("format","n2"),r(8),n("data",e.yesNo)("valuePrimitive",!0),r(4),n("data",e.yesNo)("valuePrimitive",!0),r(4),n("data",e.yesNo)("valuePrimitive",!0),r(6),n("disabled",e.saving),r(2),n("disabled",e.saving||!e.isDirty),r(),_(" ",e.saving?"Guardando...":"Guardar cambios"," ")}}var he=class s{constructor(t,e){this.service=t;this.fb=e}grid;state={skip:0,take:50,filter:void 0,sort:[]};gridView={data:[],total:0};selectedKeys=[];scrollable="scrollable";lastSearch="";isDialogOpen=!1;saving=!1;editForm;original;current;yesNo=[{text:"S\xED",value:!0},{text:"No",value:!1}];visibleColumns=[{field:"claveProducto",title:"Clave producto",width:160},{field:"nombre",title:"Nombre producto",width:260},{field:"claveBodega",title:"Clave bodega",width:150},{field:"nombreBodega",title:"Nombre bodega",width:200},{field:"claveCompania",title:"Clave compa\xF1\xEDa",width:150},{field:"nombreCompania",title:"Nombre compa\xF1\xEDa",width:220},{field:"claveTipoProducto",title:"Clave tipo producto",width:180},{field:"nombreTipoProducto",title:"Nombre tipo producto",width:220},{field:"claveUnidadProducto",title:"Clave unidad producto",width:200},{field:"unidadEntradaUP",title:"UM Entrada",width:140},{field:"unidadAlmacenUP",title:"UM Almac\xE9n",width:140},{field:"unidadSalidaUP",title:"UM Salida",width:140},{field:"tipoProducto",title:"Tipo",width:120},{field:"peso",title:"Peso",width:120,filter:"numeric"},{field:"volumen",title:"Volumen",width:120,filter:"numeric"},{field:"largo",title:"Largo",width:120,filter:"numeric"},{field:"ancho",title:"Ancho",width:120,filter:"numeric"},{field:"alto",title:"Alto",width:120,filter:"numeric"},{field:"etiqueta",title:"Etiqueta",width:160},{field:"controlCaja",title:"Control Caja",width:140,filter:"boolean"},{field:"certificado",title:"Certificado",width:140,filter:"boolean"},{field:"asignarLote",title:"Asignar Lote",width:140,filter:"boolean"},{field:"localizacion",title:"Localizaci\xF3n",width:160}];ngOnInit(){this.loadData()}ngAfterViewInit(){}mapFilterToQuery(t){if(!t||!t.filters?.length)return"";let e=[];for(let i of t.filters)if(i?.field&&i?.value!=null){let a=String(i.value).trim();if(!a)continue;(i.field==="nombre"||i.field==="claveProducto")&&e.push(a)}return e.join(" ")}dataStateChange(t){if(this.state=m(m({},this.state),t),t.filter!==void 0){let e=this.mapFilterToQuery(this.state.filter);if(this.lastSearch&&!e){this.state.skip=0,this.loadData(),this.lastSearch="";return}this.lastSearch=e}this.loadData()}loadData(){let t=Math.floor(this.state.skip/this.state.take)+1,e=this.mapFilterToQuery(this.state.filter);this.service.getProducts(t,this.state.take,e).subscribe({next:i=>{this.gridView=i,this.refreshScrollMode()},error:i=>{console.error("Error cargando productos",i),this.gridView={data:[],total:0}}})}refreshScrollMode(){this.scrollable=this.visibleColumns.length<=15?"none":"scrollable"}onEditClick(t,e){t.stopPropagation(),e&&this.openDialog(e)}onRowClick(t){t?.originalEvent?.detail>=2&&t?.dataItem&&this.openDialog(t.dataItem)}openDialog(t){this.current=m({},t),this.original=JSON.parse(JSON.stringify(t)),this.editForm=this.fb.group({claveProducto:[{value:t?.claveProducto??"",disabled:!0}],nombre:[t?.nombre??null,[U.required]],peso:[t?.peso??null],volumen:[t?.volumen??null],largo:[t?.largo??null],ancho:[t?.ancho??null],alto:[t?.alto??null],etiqueta:[t?.etiqueta??null],controlCaja:[t?.controlCaja??null],certificado:[t?.certificado??null],asignarLote:[t?.asignarLote??null],localizacion:[t?.localizacion??null]}),this.isDialogOpen=!0}closeDialog(){this.isDialogOpen=!1,this.saving=!1}get isDirty(){if(!this.editForm)return!1;let t=m(m({},this.original),this.editForm.getRawValue());return JSON.stringify(t)!==JSON.stringify(this.original)}saveChanges(){if(!this.isDialogOpen||!this.editForm){this.closeDialog();return}if(!this.isDirty){this.closeDialog();return}let t=m(m({},this.original),this.editForm.getRawValue()),e=this.gridView.data,i=e.findIndex(a=>a?.claveProducto===t?.claveProducto);if(i>-1){let a=e.slice();a[i]=m(m({},e[i]),t),this.gridView=P(m({},this.gridView),{data:a})}this.closeDialog()}onSearch(t){let e=(t||"").trim();this.state=P(m({},this.state),{skip:0});try{let i={logic:"and",filters:[]};e&&i.filters.push({field:"nombre",operator:"contains",value:e},{field:"claveProducto",operator:"contains",value:e}),this.state.filter=i,this.loadData()}catch{}}static \u0275fac=function(e){return new(e||s)(S(x),S(Z))};static \u0275cmp=V({type:s,selectors:[["app-product-catalog"]],viewQuery:function(e,i){if(e&1&&T(y,5),e&2){let a;I(a=B())&&(i.grid=a.first)}},decls:11,vars:21,consts:[["grid",""],[1,"flex","items-center","gap-2","mb-2"],["kendoButton","",3,"primary","disabled"],[3,"selectedKeysChange","dataStateChange","data","skip","pageSize","sortable","filterable","resizable","reorderable","pageable","scrollable","kendoGridSelectBy","selectedKeys","selectable","filter"],["title","",3,"width"],["kendoGridCellTemplate",""],[3,"field","title","width","filter","headerClass",4,"ngFor","ngForOf"],["kendoPagerInfoTemplate",""],[3,"close",4,"ngIf"],["kendoButton","","type","button","size","small","fillMode","solid","themeColor","base",3,"click"],[3,"field","title","width","filter","headerClass"],[3,"close"],[1,"k-form","k-form-md",2,"max-width","920px",3,"formGroup"],[1,"k-form-field"],["kendoTextBox","","formControlName","claveProducto","readonly",""],["kendoTextBox","","formControlName","nombre"],["formControlName","peso",3,"format"],["formControlName","volumen",3,"format"],["formControlName","largo",3,"format"],["formControlName","ancho",3,"format"],["formControlName","alto",3,"format"],["kendoTextBox","","formControlName","etiqueta"],["formControlName","controlCaja","textField","text","valueField","value",3,"data","valuePrimitive"],["formControlName","certificado","textField","text","valueField","value",3,"data","valuePrimitive"],["formControlName","asignarLote","textField","text","valueField","value",3,"data","valuePrimitive"],["kendoTextBox","","formControlName","localizacion"],["kendoButton","",3,"click","disabled"],["kendoButton","","themeColor","primary",3,"click","disabled"]],template:function(e,i){if(e&1){let a=w();l(0,"div",1)(1,"button",2),d(2),o()(),l(3,"kendo-grid",3,0),A("selectedKeysChange",function(u){return p(a),O(i.selectedKeys,u)||(i.selectedKeys=u),f(u)}),g("dataStateChange",function(u){return p(a),f(i.dataStateChange(u))}),c(5,"kendo-grid-checkbox-column",4),l(6,"kendo-grid-column",4),b(7,Pe,2,0,"ng-template",5),o(),b(8,Se,1,5,"kendo-grid-column",6)(9,De,1,3,"ng-template",7),o(),b(10,Ee,57,16,"kendo-dialog",8)}e&2&&(r(),n("primary",!0)("disabled",!i.selectedKeys.length),r(),_(" Eliminar seleccionados (",i.selectedKeys.length,") "),r(),n("data",i.gridView)("skip",i.state.skip)("pageSize",i.state.take)("sortable",!0)("filterable",!0)("resizable",!0)("reorderable",!0)("pageable",!0)("scrollable",i.scrollable)("kendoGridSelectBy","claveProducto"),M("selectedKeys",i.selectedKeys),n("selectable",z(20,ke))("filter",i.state.filter),r(2),n("width",50),r(),n("width",100),r(2),n("ngForOf",i.visibleColumns),r(2),n("ngIf",i.isDialogOpen))},dependencies:[j,R,L,ve,y,ge,pe,fe,ue,te,ee,re,ae,oe,ie,$,J,Q,W,H,X,Y,de,le,ne,ce,se,me],encapsulation:2})};export{he as ProductCatalogComponent};

import{Aa as o,Ab as ae,Ba as c,Bb as ne,C as E,Ca as w,Cb as le,Da as h,Db as de,Ea as v,Eb as se,Fa as B,Fb as ce,Ga as T,Gb as me,Ha as A,Hb as ue,Ia as d,Ib as pe,Jb as fe,Ka as _,Kb as ge,La as G,Lb as he,M as V,Ma as M,Mb as ve,Na as z,Nb as k,Oa as O,Ob as Ce,P as N,Pa as R,Pb as be,U as f,Ua as L,V as g,Ya as j,Za as K,_a as q,a as m,b as P,bb as U,cb as W,fb as H,ga as a,gb as Q,hb as J,ib as X,ja as b,kb as Y,lb as Z,mb as $,nb as ee,oa as I,pb as te,q as F,qa as y,xb as ie,ya as l,yb as oe,za as n,zb as re}from"./chunk-LLXGIEHY.js";var Se="https://api-sica-prolog-fmepggdmdnaxb5ac.mexicocentral-01.azurewebsites.net/api/Products/from-wsdl",x=class s{constructor(i){this.http=i}getProducts(i,e,t,r){let{claveBodega:u=1,claveCompania:p=1,idioma:we=2058,forceRefresh:_e=!1}=r??{},S=new U().set("claveBodega",String(u)).set("claveCompania",String(p)).set("idioma",String(we)).set("page",String(i)).set("pageSize",String(e)).set("forceRefresh",String(_e));return t&&t.trim()&&(S=S.set("search",t.trim())),this.http.get(Se,{params:S}).pipe(F(C=>{let D=Array.isArray(C?.items)?C.items:[],ke=typeof C?.total=="number"?C.total:D.length;return{data:D,total:ke}}))}static \u0275fac=function(e){return new(e||s)(N(W))};static \u0275prov=V({token:s,factory:s.\u0275fac,providedIn:"root"})};var De=()=>({enabled:!0,mode:"multiple",checkboxOnly:!0});function Fe(s,i){if(s&1){let e=w();n(0,"button",9),h("click",function(r){let u=f(e).$implicit,p=v();return g(p.onEditClick(r,u))}),d(1," Editar "),o()}}function Ee(s,i){if(s&1&&c(0,"kendo-grid-column",10),s&2){let e=i.$implicit;l("field",e.field)("title",e.title)("width",e.width??150)("filter",e.filter||"text")("headerClass",e.headerClass||"")}}function Ve(s,i){if(s&1&&d(0),s&2){let e=i.total,t=i.skip,r=i.pageSize;G(" Mostrando ",t+1," - ",t+r>e?e:t+r," de ",e," productos ")}}function Ne(s,i){if(s&1){let e=w();n(0,"kendo-dialog",11),h("close",function(){f(e);let r=v();return g(r.closeDialog())}),n(1,"kendo-dialog-titlebar"),d(2),o(),n(3,"form",12)(4,"div",13)(5,"label"),d(6,"Clave Producto"),o(),c(7,"input",14),o(),n(8,"div",13)(9,"label"),d(10,"Nombre"),o(),c(11,"input",15),o(),n(12,"div",13)(13,"label"),d(14,"Peso"),o(),c(15,"kendo-numerictextbox",16),o(),n(16,"div",13)(17,"label"),d(18,"Volumen"),o(),c(19,"kendo-numerictextbox",17),o(),n(20,"div",13)(21,"label"),d(22,"Largo"),o(),c(23,"kendo-numerictextbox",18),o(),n(24,"div",13)(25,"label"),d(26,"Ancho"),o(),c(27,"kendo-numerictextbox",19),o(),n(28,"div",13)(29,"label"),d(30,"Alto"),o(),c(31,"kendo-numerictextbox",20),o(),n(32,"div",13)(33,"label"),d(34,"Etiqueta"),o(),c(35,"input",21),o(),n(36,"div",13)(37,"label"),d(38,"Control Caja"),o(),c(39,"kendo-dropdownlist",22),o(),n(40,"div",13)(41,"label"),d(42,"Certificado"),o(),c(43,"kendo-dropdownlist",23),o(),n(44,"div",13)(45,"label"),d(46,"Asignar Lote"),o(),c(47,"kendo-dropdownlist",24),o(),n(48,"div",13)(49,"label"),d(50,"Localizaci\xF3n"),o(),c(51,"input",25),o()(),n(52,"kendo-dialog-actions")(53,"button",26),h("click",function(){f(e);let r=v();return g(r.closeDialog())}),d(54,"Cancelar"),o(),n(55,"button",27),h("click",function(){f(e);let r=v();return g(r.saveChanges())}),d(56),o()()()}if(s&2){let e=v();a(2),_(" Producto: ",e.current==null?null:e.current.claveProducto," "),a(),l("formGroup",e.editForm),a(12),l("format","n2"),a(4),l("format","n4"),a(4),l("format","n2"),a(4),l("format","n2"),a(4),l("format","n2"),a(8),l("data",e.yesNo)("valuePrimitive",!0),a(4),l("data",e.yesNo)("valuePrimitive",!0),a(4),l("data",e.yesNo)("valuePrimitive",!0),a(6),l("disabled",e.saving),a(2),l("disabled",e.saving||!e.isDirty),a(),_(" ",e.saving?"Guardando...":"Guardar cambios"," ")}}var ye=class s{constructor(i,e,t){this.service=i;this.fb=e;this.cdr=t}grid;state={skip:0,take:50,filter:void 0,sort:[]};gridView={data:[],total:0};loading=!1;selectedKeys=[];scrollable="scrollable";search="";isDialogOpen=!1;saving=!1;editForm;original;current;yesNo=[{text:"S\xED",value:!0},{text:"No",value:!1}];visibleColumns=[{field:"claveProducto",title:"Clave producto",width:160},{field:"nombre",title:"Nombre producto",width:260},{field:"claveBodega",title:"Clave bodega",width:150},{field:"nombreBodega",title:"Nombre bodega",width:200},{field:"claveCompania",title:"Clave compa\xF1\xEDa",width:150},{field:"nombreCompania",title:"Nombre compa\xF1\xEDa",width:220},{field:"claveTipoProducto",title:"Clave tipo producto",width:180},{field:"nombreTipoProducto",title:"Nombre tipo producto",width:220},{field:"claveUnidadProducto",title:"Clave unidad producto",width:200},{field:"unidadEntradaUP",title:"UM Entrada",width:140},{field:"unidadAlmacenUP",title:"UM Almac\xE9n",width:140},{field:"unidadSalidaUP",title:"UM Salida",width:140},{field:"tipoProducto",title:"Tipo",width:120},{field:"peso",title:"Peso",width:120,filter:"numeric"},{field:"volumen",title:"Volumen",width:120,filter:"numeric"},{field:"largo",title:"Largo",width:120,filter:"numeric"},{field:"ancho",title:"Ancho",width:120,filter:"numeric"},{field:"alto",title:"Alto",width:120,filter:"numeric"},{field:"etiqueta",title:"Etiqueta",width:160},{field:"controlCaja",title:"Control Caja",width:140,filter:"boolean"},{field:"certificado",title:"Certificado",width:140,filter:"boolean"},{field:"asignarLote",title:"Asignar Lote",width:140,filter:"boolean"},{field:"localizacion",title:"Localizaci\xF3n",width:160}];ngOnInit(){this.loadData()}ngAfterViewInit(){}searchableFields=new Set(["claveProducto","nombre"]);getSearchFromFilter(i){if(!i)return;let t=this.collectFilterValues(i).find(r=>typeof r.value=="string"&&r.value?.toString().trim().length&&this.searchableFields.has(r.field));return t?t.value.toString().trim():void 0}collectFilterValues(i){let e=[];if(!i)return e;if(Array.isArray(i.filters))for(let t of i.filters)e.push(...this.collectFilterValues(t));else i.field&&e.push({field:i.field,value:i.value,operator:i.operator});return e}dataStateChange(i){this.state=m(m({},this.state),i),this.loadData()}loadData(){if(this.loading)return;let i=this.state.skip/this.state.take+1,e=this.state.take,t=this.getSearchFromFilter(this.state.filter),r=this.search?.trim()||t||void 0;this.loading=!0,this.cdr.markForCheck(),this.service.getProducts(i,e,r).pipe(E(()=>{this.loading=!1,this.cdr.markForCheck()})).subscribe({next:u=>{this.gridView={data:u?.data??[],total:u?.total??0},this.cdr.markForCheck()},error:u=>{console.error("Error cargando productos",u),this.gridView={data:[],total:0},this.cdr.markForCheck()}})}onEditClick(i,e){i?.preventDefault(),this.current=e,this.openDialog()}openDialog(){this.isDialogOpen=!0,this.original=m({},this.current||{}),this.editForm=this.fb.group({claveProducto:[{value:this.current?.claveProducto??"",disabled:!0}],nombre:[this.current?.nombre??"",[Q.required]],peso:[this.current?.peso??null],volumen:[this.current?.volumen??null],largo:[this.current?.largo??null],ancho:[this.current?.ancho??null],alto:[this.current?.alto??null],etiqueta:[this.current?.etiqueta??""],controlCaja:[this.current?.controlCaja??!1],certificado:[this.current?.certificado??!1],asignarLote:[this.current?.asignarLote??!1],localizacion:[this.current?.localizacion??""]})}closeDialog(){this.saving||(this.isDialogOpen=!1,this.current=void 0)}get isDirty(){if(!this.editForm||!this.original)return!1;let i=m(m({},this.original),this.editForm.getRawValue());return JSON.stringify(i)!==JSON.stringify(this.original)}saveChanges(){if(this.saving||!this.current||!this.editForm?.valid)return;this.saving=!0;let i=m(m({},this.original),this.editForm.getRawValue()),e=Array.isArray(this.gridView?.data)?[...this.gridView.data]:[],t=e.findIndex(r=>r?.claveProducto===this.original?.claveProducto);t>=0&&(e[t]=m(m({},e[t]),i),this.gridView=P(m({},this.gridView),{data:e})),this.saving=!1,this.closeDialog()}onSearch(i){this.search=i??"",this.state=P(m({},this.state),{skip:0}),this.loadData()}static \u0275fac=function(e){return new(e||s)(b(x),b(ee),b(L))};static \u0275cmp=I({type:s,selectors:[["app-product-catalog"]],viewQuery:function(e,t){if(e&1&&B(k,5),e&2){let r;T(r=A())&&(t.grid=r.first)}},decls:11,vars:22,consts:[["grid",""],[1,"flex","items-center","gap-2","mb-2"],["kendoButton","",3,"primary","disabled"],[3,"selectedKeysChange","dataStateChange","data","skip","pageSize","sortable","filterable","resizable","reorderable","loading","pageable","scrollable","kendoGridSelectBy","selectedKeys","selectable","filter"],["title","",3,"width"],["kendoGridCellTemplate",""],[3,"field","title","width","filter","headerClass",4,"ngFor","ngForOf"],["kendoPagerInfoTemplate",""],[3,"close",4,"ngIf"],["kendoButton","","type","button","size","small","fillMode","solid","themeColor","base",3,"click"],[3,"field","title","width","filter","headerClass"],[3,"close"],[1,"k-form","k-form-md",2,"max-width","920px",3,"formGroup"],[1,"k-form-field"],["kendoTextBox","","formControlName","claveProducto","readonly",""],["kendoTextBox","","formControlName","nombre"],["formControlName","peso",3,"format"],["formControlName","volumen",3,"format"],["formControlName","largo",3,"format"],["formControlName","ancho",3,"format"],["formControlName","alto",3,"format"],["kendoTextBox","","formControlName","etiqueta"],["formControlName","controlCaja","textField","text","valueField","value",3,"data","valuePrimitive"],["formControlName","certificado","textField","text","valueField","value",3,"data","valuePrimitive"],["formControlName","asignarLote","textField","text","valueField","value",3,"data","valuePrimitive"],["kendoTextBox","","formControlName","localizacion"],["kendoButton","",3,"click","disabled"],["kendoButton","","themeColor","primary",3,"click","disabled"]],template:function(e,t){if(e&1){let r=w();n(0,"div",1)(1,"button",2),d(2),o()(),n(3,"kendo-grid",3,0),O("selectedKeysChange",function(p){return f(r),z(t.selectedKeys,p)||(t.selectedKeys=p),g(p)}),h("dataStateChange",function(p){return f(r),g(t.dataStateChange(p))}),c(5,"kendo-grid-checkbox-column",4),n(6,"kendo-grid-column",4),y(7,Fe,2,0,"ng-template",5),o(),y(8,Ee,1,5,"kendo-grid-column",6)(9,Ve,1,3,"ng-template",7),o(),y(10,Ne,57,16,"kendo-dialog",8)}e&2&&(a(),l("primary",!0)("disabled",!t.selectedKeys.length),a(),_(" Eliminar seleccionados (",t.selectedKeys.length,") "),a(),l("data",t.gridView)("skip",t.state.skip)("pageSize",t.state.take)("sortable",!0)("filterable",!0)("resizable",!0)("reorderable",!0)("loading",t.loading)("pageable",!0)("scrollable",t.scrollable)("kendoGridSelectBy","claveProducto"),M("selectedKeys",t.selectedKeys),l("selectable",R(21,De))("filter",t.state.filter),a(2),l("width",50),a(),l("width",100),a(2),l("ngForOf",t.visibleColumns),a(2),l("ngIf",t.isDialogOpen))},dependencies:[q,j,K,be,k,Ce,he,ve,ge,oe,ie,le,ne,ae,re,te,Y,H,J,X,Z,$,ce,de,se,ue,me,pe,fe],encapsulation:2})};export{ye as ProductCatalogComponent};
